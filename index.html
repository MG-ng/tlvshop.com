<html>
<head>
    <title>TLV shop - buy stickers atomically over the Lightning Network</title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<body class="bg-light">

<div class="container">

    <div class="py-5 text-center">
        <h1>TLV shop</h1>
        <p class="lead">Buy stickers atomically over the Lightning Network</p>
        <div class="mb-5"></div>

        <p>
            Welcome to <a href="https://tlvshop.com">tlvshop.com</a>!
            <br/><br/>
            This is not an ordinary webshop. There is no browser, no shopping cart,
            no checkout page and no credit card required. What is it then? It is a 100%
            pure Lightning shop, possibly one of the first of its kind.
            <br/><br/>
            The current offering is rather limited. In fact the only article that we
            currently sell is a set of three cool "RUN LND" stickers:<br/>
            <img src="runlnd.jpg" alt="RUN LND" width="300" style="margin: 15px">
            <br/><br/>
            There are no prices either. The sticker market fluctuates and bitcoin
            fluctuates, so it would all get too complicated for us humble operators of this
            experimental project that aims to demonstrate the future of online shopping.
            <br/><br/>
            So what does it mean, pure Lightning? It means that the only communication
            between buyer and us is a Lightning payment. Since the introduction of custom
            tlv records (hence the name <a href="https://tlvshop.com">tlvshop.com</a>), it is possible to attach
            arbitrary data to a payment. We use this new functionality to attach your delivery
            address to the payment.
            <br/><br/>
            In short this means that you can order, pay for and get your stickers delivered
            with just a single <code>lncli</code> command. And more importantly, your identity will
            remain hidden. Obviously only if you don't get your stickers delivered to your
            home address...
            <br/><br/>
            To make it easy to place an order, we provide a <code>lncli</code> command line generator
            below. Please note that none of what you enter there is sent out on the network directly.
            You could download this page and run it offline to be absolutely sure.
            <br/><br/>
            Back to the question of price. It is simple. We only take your money if the
            amount is sufficient for us to cover the cost. Otherwise we'll cancel back your
            HTLC. So there is some price discovery going on. If you don't like that,
            remember that easy isn't always the most fun.
            <br/><br/>
            Also, make sure you enter your address correctly. As you remain anonymous,
            we can't refund. And also not verify any claims of something going wrong. So in
            short, all of this is reckless and we only guarantee to make the best of it.
            <br/><br/>
            Happy buying!
        </p>
    </div>

    <div class="row">
        <div class="col-md-12">
            <h4 class="mb-3">Delivery address</h4>
            <form class="needs-validation" novalidate id="orderform">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="firstName">First name</label>
                        <input type="text" class="form-control" id="firstName" placeholder="" value="" required>
                        <div class="invalid-feedback">
                            Valid first name is required.
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="lastName">Last name</label>
                        <input type="text" class="form-control" id="lastName" placeholder="" value="" required>
                        <div class="invalid-feedback">
                            Valid last name is required.
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="address">Address</label>
                    <input type="text" class="form-control" id="address" placeholder="1234 Main St" required>
                    <div class="invalid-feedback">
                        Please enter your shipping address.
                    </div>
                </div>

                <div class="mb-3">
                    <label for="address2">Address 2 <span class="text-muted">(Optional)</span></label>
                    <input type="text" class="form-control" id="address2" placeholder="Apartment or suite">
                </div>

                <div class="row">
                    <div class="col-md-5 mb-3">
                        <label for="country">Country</label>
                        <select class="custom-select d-block w-100" id="country" required>
                            <option value="">Choose...</option>
                            <option>United States</option>
                        </select>
                        <div class="invalid-feedback">
                            Please select a valid country.
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="state">State</label>
                        <select class="custom-select d-block w-100" id="state" required>
                            <option value="">Choose...</option>
                            <option>California</option>
                        </select>
                        <div class="invalid-feedback">
                            Please provide a valid state.
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="zip">Zip</label>
                        <input type="text" class="form-control" id="zip" placeholder="" required>
                        <div class="invalid-feedback">
                            Zip code required.
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="city">City</label>
                    <input type="text" class="form-control" id="city" placeholder="">
                    <div class="invalid-feedback">
                        Please enter a valid city.
                    </div>
                </div>

                <div class="mb-3">
                    <label for="amount">Amount (sats)</label>
                    <input type="number" class="form-control" id="amount" placeholder="find out">
                    <div class="invalid-feedback">
                        Please enter a valid amount in satoshis.
                    </div>
                </div>

                <div class="mb-3">
                    <label for="email">Email <span class="text-muted">(Optional)</span></label>
                    <input type="email" class="form-control" id="email" placeholder="you@example.com">
                    <div class="invalid-feedback">
                        Please enter a valid email address for shipping updates.
                    </div>
                </div>

            </form>
        </div>

        <div class="col-md-12">
            <h4 class="mb-3">The command to run</h4>
            <p>
                All you need to do is to run the following command. If the payment succeeds, the order is submitted.
                If not, try a different price and/or make sure you are able to pay on mainnet.
            </p>
            <kbd id="command"></kbd>
            <textarea id="command-hidden" class="sr-only"></textarea>

            <div class="pb-5"></div>
            <button class="btn btn-secondary" id="copy">Copy command to clipboard</button>
            <div class="pb-5"></div>
            <div class="pb-5"></div>
        </div>

    </div>
</div>

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

<script src="countries.js"></script>

<script>

    const dataTypeShippingAddress = 98117121;
    const destinationPubkey = "023e18169f9b4253eff56bd7035660b28c95e61e12fabc03f4aef59d102d55bbb0";
    const command = `lncli sendpayment --keysend --dest ${destinationPubkey}`;


    // country/state script by IshanDemon, visit github.com/IshanDemon
    populateCountries("country", "state");

    $(document).ready(function () {
        update();
        $('#orderform input').keyup(update).change(update);

        $('#copy').click(function () {
            const cmdEl = document.getElementById('command-hidden');
            cmdEl.select();
            cmdEl.setSelectionRange(0, 99999);
            document.execCommand('copy');
        });
    });

    function update() {
        let firstName = $('#firstName').val();
        let lastName = $('#lastName').val();
        let address = $('#address').val();
        let address2 = $('#address2').val();
        let zip = $('#zip').val();
        let state = $('#state').val();
        let country = $('#country').val();
        let city = $('#city').val();
        let email = $('#email').val();
        let addr = [
            `${firstName} ${lastName}`,
            address, address2,
            `${state} ${zip} ${city}`,
            country,
            email
        ].join('|');
        let amount = $('#amount').val();
        let cmd = `${command} --data ${dataTypeShippingAddress}=${toHex(addr)} --amt ${amount}`;
        $('#command').text(cmd);
        $('#command-hidden').text(cmd);
    }

    function toHex(str) {
        let hex = '';
        try {
            hex = unescape(encodeURIComponent(str))
                .split('').map(function (v) {
                    return v.charCodeAt(0).toString(16)
                }).join('')
        } catch (e) {
            hex = str;
            console.log('invalid text input: ' + str)
        }
        return hex
    }
</script>
</body>
</html>